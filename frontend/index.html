<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Story Narrative AI</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            background: linear-gradient(to right, #4e54c8, #8f94fb);
            min-height: 100vh;
        }
        h1, h5 {
            color: #fff;
        }
        .center-card {
            max-width: 700px;
            margin: auto;
        }
        .book-view {
            background: #fff;
            border-radius: 12px;
            padding: 25px;
            min-height: 460px;
            font-family: Georgia, serif;
        }
        .story-title {
            text-align: center;
            font-size: 26px;
            font-weight: bold;
        }
        .story-genre {
            text-align: center;
            font-style: italic;
            color: #666;
        }
        .story-text {
            white-space: pre-line;
            font-size: 16px;
            line-height: 1.7;
            margin-top: 15px;
        }
        .option-card:hover {
            background-color: #f5f5f5;
            cursor: pointer;
        }
        .hint {
            font-size: 13px;
            color: #555;
        }
    </style>
</head>

<body>

<div class="container-fluid py-5">
    <h1 class="text-center mb-4">ðŸ“– Story Narrative AI</h1>

    <!-- ========= STATE 1 : INITIAL (FULL WIDTH) ========= -->
    <div id="initialScreen">
        <div class="card p-4 shadow center-card">
            <h5 class="mb-3 text-center">Start Your Story</h5>

            <div class="mb-3">
                <label class="form-label">Genre</label>
                <select class="form-select" id="genreSelect">
                    <option value="" disabled selected>Select genre</option>
                    <option>Fantasy</option>
                    <option>Romance</option>
                    <option>Horror</option>
                    <option>Science Fiction</option>
                </select>
            </div>

            <div class="mb-3">
                <label class="form-label">Story Title</label>
                <input type="text" class="form-control" id="storyTitle"
                       placeholder="Enter story title...">
            </div>

            <div class="mb-3">
                <label class="form-label">Opening Line</label>
                <textarea class="form-control" id="openingLine" rows="3"
                          placeholder="Once upon a time..."></textarea>
            </div>

            <button id="startStoryBtn" class="btn btn-primary w-100">
                Start Story
            </button>
        </div>
    </div>

    <!-- ========= STATE 2 : WRITING MODE ========= -->
    <div id="writingScreen" style="display:none;">
        <div class="row mt-4">

            <!-- LEFT : CONTROLS -->
            <div class="col-md-4">
                <div class="card p-4 shadow mb-4">
                    <h5 class="mb-2">Continue Story</h5>
                    <p class="hint">Tone, length & results required. Idea optional.</p>

                    <div class="mb-3">
                        <label class="form-label">Tone</label>
                        <select class="form-select" id="toneSelect">
                            <option value="" disabled selected>Select tone</option>
                            <option>Dark</option>
                            <option>Emotional</option>
                            <option>Humorous</option>
                            <option>Inspirational</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Story Length</label>
                        <select class="form-select" id="lengthSelect">
                            <option value="" disabled selected>Select length</option>
                            <option>Short</option>
                            <option>Medium</option>
                            <option>Long</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Number of Results</label>
                        <select class="form-select" id="resultCount">
                            <option value="" disabled selected>Select number</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                        </select>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Your Next Line / Idea (optional)</label>
                        <textarea class="form-control" id="continuationInput" rows="3"
                                  placeholder="Optional guidance..."></textarea>
                    </div>

                    <button id="generateBtn" class="btn btn-success w-100">
                        Generate Continuation
                    </button>
                </div>
            </div>

            <!-- RIGHT : BOOK -->
            <div class="col-md-8">
                <div class="d-flex justify-content-end mb-2 gap-2">
                    <button id="saveBookBtn" class="btn btn-outline-success btn-sm">ðŸ’¾ Save Book</button>
                    <button id="newBookBtn" class="btn btn-outline-danger btn-sm">âž• New Book</button>
                </div>

                <h5 class="mb-2">ðŸ“˜ Story Book</h5>

                <div class="book-view">
                    <div id="bookTitle" class="story-title"></div>
                    <div id="bookGenre" class="story-genre"></div>
                    <hr>
                    <div id="storyContent" class="story-text"></div>
                </div>
            </div>

        </div>
    </div>
</div>

<!-- ========= MODAL ========= -->
<div class="modal fade" id="continuationModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Choose Continuation</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row g-3" id="modalOptions"></div>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
const modal = new bootstrap.Modal(document.getElementById("continuationModal"));

/* START STORY */
startStoryBtn.onclick = () => {
    if (!genreSelect.value || !storyTitle.value || !openingLine.value) {
        alert("Please complete all fields.");
        return;
    }

    bookTitle.textContent = storyTitle.value;
    bookGenre.textContent = genreSelect.value;
    storyContent.textContent = openingLine.value;

    initialScreen.style.display = "none";
    writingScreen.style.display = "block";
};

/* GENERATE CONTINUATION */
generateBtn.onclick = () => {
    if (!toneSelect.value || !lengthSelect.value || !resultCount.value) {
        alert("Please select tone, length and number of results.");
        return;
    }

    modalOptions.innerHTML = "";
    const count = parseInt(resultCount.value);
    const colClass = count === 1 ? "col-12" : count === 2 ? "col-md-6" : "col-md-4";

    for (let i = 1; i <= count; i++) {
        const text = `Option ${i}: The story continues, shaped by your choices.`;

        const col = document.createElement("div");
        col.className = colClass;
        col.innerHTML = `
            <div class="card p-3 h-100 option-card">
                <p>${text}</p>
                <button class="btn btn-sm btn-success mt-auto">Choose</button>
            </div>
        `;

        col.querySelector("button").onclick = () => {
            // Append story
            storyContent.textContent += "\n\n" + text;

            // CLEAR continuation inputs
            toneSelect.selectedIndex = 0;
            lengthSelect.selectedIndex = 0;
            resultCount.selectedIndex = 0;
            continuationInput.value = "";

            modal.hide();
        };

        modalOptions.appendChild(col);
    }

    modal.show();
};

/* SAVE BOOK */
saveBookBtn.onclick = () => {
    const content =
        `Title: ${bookTitle.textContent}\n` +
        `Genre: ${bookGenre.textContent}\n\n` +
        storyContent.textContent;

    const blob = new Blob([content], { type: "text/plain" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = `${bookTitle.textContent.replace(/\s+/g, "_")}.txt`;
    link.click();
};

/* NEW BOOK */
newBookBtn.onclick = () => {
    if (!confirm("Your current book may not be saved. Do you wish to continue?")) return;
    location.reload();
};
</script>

</body>
</html>
